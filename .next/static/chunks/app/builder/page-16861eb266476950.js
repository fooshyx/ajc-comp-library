(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[462],{3224:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});var i=s(5155),r=s(2115),l=s(2108),n=s(5953);function a(){var e,t,s,a,o;let{data:d}=(0,l.useSession)();(0,r.useEffect)(()=>{var e;(null==d||null==(e=d.user)?void 0:e.id)||(window.location.href="/")},[d]);let[c,m]=(0,r.useState)([]),[u,x]=(0,r.useState)([]),[h,g]=(0,r.useState)([]),[p,b]=(0,r.useState)([]),[v,j]=(0,r.useState)([1,2,3,4,5]),[f,y]=(0,r.useState)(""),[N,w]=(0,r.useState)(!0),[C,k]=(0,r.useState)({name:"",description:"",units:[],rating:"",isPublic:!1}),[S,P]=(0,r.useState)(Array(28).fill(null)),[I,T]=(0,r.useState)("units"),[B,E]=(0,r.useState)(null),[A,_]=(0,r.useState)("all");(0,r.useEffect)(()=>{(async()=>{try{w(!0);let e=await n.W.getAllGameData();m(e.units),x(e.traits),g(e.items),b(e.components);let t=sessionStorage.getItem("editComposition");if(t)try{let e=JSON.parse(t);k({name:e.name,description:e.description||"",units:e.units,rating:e.rating||"",isPublic:e.isPublic}),sessionStorage.removeItem("editComposition")}catch(e){console.error("Error loading composition for editing:",e)}}catch(e){console.error("Error loading game data:",e)}finally{w(!1)}})()},[]),(0,r.useEffect)(()=>{let e=Array(28).fill(null);C.units.forEach(t=>{t.position>=0&&t.position<28&&(e[t.position]=t)}),P(e)},[C.units]);let U=c.filter(e=>{let t=v.includes(e.cost),s=e.name.toLowerCase().includes(f.toLowerCase());return t&&s}),q=u.map(e=>{let t=C.units.filter(t=>{let s=c.find(e=>e.id===t.unitId);return null==s?void 0:s.traits.includes(e.name)}).length;if(0===t)return null;let s=e.breakpoints.filter(e=>t>=e.num).sort((e,t)=>t.num-e.num)[0];return{...e,count:t,activeBreakpoint:s||null,isActive:t>0}}).filter(e=>null!==e),F="all"===A?h:h.filter(e=>e.type===A),M=async()=>{var e,t;if(console.log("Session data:",d),console.log("User ID:",null==d||null==(e=d.user)?void 0:e.id),console.log("Composition name:",C.name),console.log("Composition units:",C.units),!(null==d||null==(t=d.user)?void 0:t.id))return void alert("Please log in first");if(!C.name.trim())return void alert("Please provide a composition name");if(0===C.units.length)return void alert("Please add at least one unit to your composition");try{let e={userId:d.user.id,addedBy:d.user.name||d.user.email||"Unknown",name:C.name.trim(),description:C.description.trim()||null,units:C.units,rating:C.rating||null,isPublic:C.isPublic};console.log("Sending composition data:",e);let t=await n.W.saveComposition(e);console.log("Save result:",t),t?alert("Composition saved successfully!"):alert("Failed to save composition - no result returned")}catch(e){console.error("Error saving composition:",e),alert("Failed to save composition: ".concat(e instanceof Error?e.message:"Unknown error"))}};return N?(0,i.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,i.jsx)("div",{className:"text-lg",children:"Loading game data..."})}):(0,i.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,i.jsxs)("div",{className:"mb-8",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Composition Builder"}),(0,i.jsx)("p",{className:"text-gray-600 mt-2",children:"Build and save your TFT team compositions"})]}),(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,i.jsx)("input",{type:"text",placeholder:"Composition Name",value:C.name,onChange:e=>k(t=>({...t,name:e.target.value})),className:"p-2 border border-gray-300 rounded-md"}),(0,i.jsx)("input",{type:"text",placeholder:"Description (optional)",value:C.description,onChange:e=>k(t=>({...t,description:e.target.value})),className:"p-2 border border-gray-300 rounded-md"}),(0,i.jsx)("div",{children:(0,i.jsxs)("select",{value:C.rating,onChange:e=>k(t=>({...t,rating:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-md",children:[(0,i.jsx)("option",{value:"",children:"Select Rating (Optional)"}),(0,i.jsx)("option",{value:"S",children:"S Tier - Meta"}),(0,i.jsx)("option",{value:"A",children:"A Tier - Strong"}),(0,i.jsx)("option",{value:"B",children:"B Tier - Good"}),(0,i.jsx)("option",{value:"C",children:"C Tier - Situational"})]})})]}),C.rating&&(0,i.jsx)("div",{className:"mb-4",children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Rating Preview:"}),(0,i.jsxs)("span",{className:"px-3 py-1 rounded-full text-sm font-bold ".concat((e=>{switch(e){case"S":return"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white";case"A":return"bg-gradient-to-r from-green-400 to-green-600 text-white";case"B":return"bg-gradient-to-r from-blue-400 to-blue-600 text-white";case"C":return"bg-gradient-to-r from-gray-400 to-gray-600 text-white";default:return"bg-gray-200 text-gray-600"}})(C.rating)),children:[C.rating," Tier"]})]})}),(0,i.jsx)("div",{className:"mb-4",children:(0,i.jsxs)("label",{className:"flex items-center gap-2",children:[(0,i.jsx)("input",{type:"checkbox",checked:C.isPublic,onChange:e=>k(t=>({...t,isPublic:e.target.checked})),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,i.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Make this composition public"}),(0,i.jsx)("span",{className:"text-xs text-gray-500",children:"(Public compositions can be viewed by all users)"})]})}),(0,i.jsxs)("div",{className:"flex gap-3",children:[(0,i.jsx)("button",{onClick:M,disabled:!d||!C.name.trim(),className:"bg-blue-600 hover:bg-blue-700 disabled:opacity-50 text-white px-4 py-2 rounded-md text-sm font-medium",children:"Save Composition"}),(0,i.jsx)("button",{onClick:()=>{k(e=>({...e,units:[]}))},className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md text-sm font-medium",children:"Clear Board"})]})]}),(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,i.jsx)("div",{className:"lg:col-span-1",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-md",children:[(0,i.jsx)("div",{className:"border-b border-gray-200",children:(0,i.jsxs)("nav",{className:"-mb-px flex space-x-8 px-6",children:[(0,i.jsxs)("button",{onClick:()=>T("units"),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat("units"===I?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:["Units (",U.length,")"]}),(0,i.jsxs)("button",{onClick:()=>T("traits"),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat("traits"===I?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:["Traits (",q.length,")"]}),(0,i.jsxs)("button",{onClick:()=>T("items"),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat("items"===I?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:["Items (",h.length,")"]})]})}),(0,i.jsxs)("div",{className:"p-6",children:["units"===I&&(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)("input",{type:"text",placeholder:"Search units...",value:f,onChange:e=>y(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cost Filter"}),(0,i.jsx)("div",{className:"flex flex-wrap gap-2",children:[1,2,3,4,5].map(e=>(0,i.jsxs)("label",{className:"flex items-center",children:[(0,i.jsx)("input",{type:"checkbox",checked:v.includes(e),onChange:t=>{t.target.checked?j(t=>[...t,e]):j(t=>t.filter(t=>t!==e))},className:"mr-1"}),(0,i.jsxs)("span",{className:"text-sm",children:[e," cost"]})]},e))})]}),null!==B&&!S[B]&&(0,i.jsx)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md",children:(0,i.jsxs)("p",{className:"text-sm text-blue-800 font-medium",children:["Position ",B+1," selected - Choose a unit to place"]})}),(0,i.jsx)("div",{className:"max-h-96 overflow-y-auto space-y-2",children:U.map(e=>(0,i.jsxs)("div",{className:"\n                          flex items-center p-2 rounded-md cursor-pointer transition-colors\n                          ".concat(null===B||S[B]?"bg-gray-50 hover:bg-gray-100":"bg-blue-50 hover:bg-blue-100 border border-blue-200","\n                        "),onClick:()=>(e=>{if(null===B||S[B])return;let t={unitId:e.id,position:B,items:[]};k(e=>({...e,units:[...e.units,t]})),E(null),T("units")})(e),children:[(0,i.jsx)("img",{src:e.image,alt:e.name,className:"w-8 h-8 rounded mr-3"}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("div",{className:"font-medium text-sm",children:e.name}),(0,i.jsxs)("div",{className:"text-xs text-gray-500",children:["Cost: ",e.cost," | ",e.traits.join(", ")]})]})]},e.id))}),null===B&&(0,i.jsx)("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:(0,i.jsx)("p",{className:"text-sm text-yellow-800",children:"Select an empty square on the board first, then choose a unit to place there."})})]}),"traits"===I&&(0,i.jsxs)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:[q.map(e=>(0,i.jsxs)("div",{className:"flex items-center p-2 bg-gray-50 rounded-md",children:[(0,i.jsx)("div",{className:"w-8 h-8 rounded mr-3 flex items-center justify-center",dangerouslySetInnerHTML:{__html:e.image}}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("div",{className:"font-medium text-sm",children:e.name}),(0,i.jsxs)("div",{className:"text-xs text-gray-500",children:["Active: ",e.count," units"]})]})]},e.id)),0===q.length&&(0,i.jsx)("div",{className:"text-center text-gray-500 py-8",children:"Place units on the board to see active traits"})]}),"items"===I&&(0,i.jsxs)("div",{className:"space-y-4",children:[null!==B&&S[B]&&(0,i.jsxs)("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-md",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("img",{src:null==(e=c.find(e=>{var t;return e.id===(null==(t=S[B])?void 0:t.unitId)}))?void 0:e.image,alt:"Selected unit",className:"w-6 h-6 rounded mr-2"}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("p",{className:"text-sm text-green-800 font-medium",children:["Managing items for ",null==(t=c.find(e=>{var t;return e.id===(null==(t=S[B])?void 0:t.unitId)}))?void 0:t.name]}),(0,i.jsxs)("p",{className:"text-xs text-green-600",children:[(null==(s=S[B])?void 0:s.items.length)||0,"/3 items equipped"]})]})]}),(null==(a=S[B])?void 0:a.items.length)>0&&(0,i.jsxs)("div",{className:"mt-3",children:[(0,i.jsx)("p",{className:"text-xs font-medium text-green-700 mb-2",children:"Current Items:"}),(0,i.jsx)("div",{className:"flex flex-wrap gap-2",children:null==(o=S[B])?void 0:o.items.map((e,t)=>{let s=h.find(t=>t.id===e);return(0,i.jsxs)("div",{className:"flex items-center bg-white rounded px-2 py-1 border border-green-200 cursor-pointer hover:bg-red-50",onClick:()=>{null!==B&&k(e=>({...e,units:e.units.map(e=>e.position===B?{...e,items:e.items.filter((e,s)=>s!==t)}:e)}))},children:[(0,i.jsx)("img",{src:null==s?void 0:s.image,alt:null==s?void 0:s.name,className:"w-4 h-4 rounded mr-1"}),(0,i.jsx)("span",{className:"text-xs",children:null==s?void 0:s.name}),(0,i.jsx)("span",{className:"ml-1 text-red-500 hover:text-red-700",children:"\xd7"})]},t)})})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Type"}),(0,i.jsx)("div",{className:"flex flex-wrap gap-2",children:["all","standard","emblem","artifact","other"].map(e=>(0,i.jsx)("button",{onClick:()=>_(e),className:"px-3 py-1 rounded-full text-xs font-medium transition-colors ".concat(A===e?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),(0,i.jsx)("div",{className:"max-h-80 overflow-y-auto space-y-2",children:F.map(e=>{var t;return(0,i.jsxs)("div",{className:"\n                          flex items-center p-2 rounded-md cursor-pointer transition-colors\n                          ".concat(null!==B&&S[B]&&(null==(t=S[B])?void 0:t.items.length)<3?"bg-green-50 hover:bg-green-100 border border-green-200":"bg-gray-50 hover:bg-gray-100","\n                        "),onClick:()=>(e=>{if(null===B)return;let t=S[B];t&&!(t.items.length>=3)&&k(t=>({...t,units:t.units.map(t=>t.position===B?{...t,items:[...t.items,e]}:t)}))})(e.id),children:[(0,i.jsx)("img",{src:e.image,alt:e.name,className:"w-8 h-8 rounded mr-3"}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("div",{className:"font-medium text-sm",children:e.name}),(0,i.jsx)("div",{className:"text-xs text-gray-500 capitalize",children:e.type})]})]},e.id)})}),null===B&&(0,i.jsx)("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:(0,i.jsx)("p",{className:"text-sm text-yellow-800",children:"Select a unit on the board to manage its items."})}),null!==B&&!S[B]&&(0,i.jsx)("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:(0,i.jsx)("p",{className:"text-sm text-yellow-800",children:"The selected square is empty. Place a unit first to manage items."})})]})]})]})}),(0,i.jsx)("div",{className:"lg:col-span-2",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,i.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Team Board"}),q.length>0&&(0,i.jsxs)("div",{className:"mb-6 bg-gray-50 rounded-lg p-4",children:[(0,i.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Active Traits"}),(0,i.jsx)("div",{className:"flex flex-wrap gap-2",children:q.map(e=>{var t,s;return(0,i.jsxs)("div",{className:"flex items-center space-x-2 bg-white rounded-lg p-2 border",style:{borderColor:(null==(t=e.activeBreakpoint)?void 0:t.color)||"#e5e7eb",backgroundColor:e.activeBreakpoint?"".concat(e.activeBreakpoint.color,"10"):"white"},children:[(0,i.jsx)("div",{className:"w-6 h-6 rounded flex items-center justify-center",dangerouslySetInnerHTML:{__html:e.image}}),(0,i.jsxs)("div",{className:"text-sm",children:[(0,i.jsx)("span",{className:"font-medium",children:e.name}),(0,i.jsx)("span",{className:"ml-2 px-1.5 py-0.5 rounded text-xs font-bold text-white",style:{backgroundColor:(null==(s=e.activeBreakpoint)?void 0:s.color)||"#6b7280"},children:e.count})]})]},e.id)})})]}),(0,i.jsx)("div",{className:"grid grid-cols-7 gap-2 mb-4",children:S.map((e,t)=>{let s=e?c.find(t=>t.id===e.unitId):null,r=B===t;return(0,i.jsx)("div",{className:"\n                      aspect-square border-2 rounded-lg flex flex-col items-center justify-center cursor-pointer relative\n                      ".concat(r?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400","\n                      ").concat(s?"bg-gray-100":"bg-gray-50","\n                    "),onClick:()=>{S[t]?(E(t),T("items")):(E(t),T("units"))},children:s&&e?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{onClick:e=>{e.stopPropagation(),k(e=>({...e,units:e.units.filter(e=>e.position!==t)})),B===t&&E(null)},className:"absolute -top-1 -right-1 bg-red-500 hover:bg-red-600 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs z-10",children:"\xd7"}),(0,i.jsx)("img",{src:s.image,alt:s.name,className:"w-8 h-8 rounded mb-1"}),(0,i.jsx)("div",{className:"text-xs text-center font-medium truncate w-full px-1",children:s.name}),e.items.length>0&&(0,i.jsx)("div",{className:"flex gap-1 mt-1",children:e.items.slice(0,3).map((e,t)=>{let s=h.find(t=>t.id===e);return(0,i.jsx)("img",{src:null==s?void 0:s.image,alt:null==s?void 0:s.name,className:"w-3 h-3 rounded border border-gray-400"},t)})})]}):(0,i.jsx)("div",{className:"text-xs text-gray-400 text-center",children:t+1})},t)})}),(0,i.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,i.jsx)("p",{children:(0,i.jsx)("strong",{children:"New Workflow:"})}),(0,i.jsxs)("ul",{className:"list-disc list-inside mt-1 space-y-1",children:[(0,i.jsxs)("li",{children:[(0,i.jsx)("strong",{children:"Step 1:"})," Click an empty square on the board to select it"]}),(0,i.jsxs)("li",{children:[(0,i.jsx)("strong",{children:"Step 2:"})," Choose a unit from the Units tab to place there"]}),(0,i.jsxs)("li",{children:[(0,i.jsx)("strong",{children:"Step 3:"})," Click a unit on the board to manage its items"]}),(0,i.jsxs)("li",{children:[(0,i.jsx)("strong",{children:"Remove:"})," Use the red \xd7 button on any unit to remove it"]}),(0,i.jsxs)("li",{children:[(0,i.jsx)("strong",{children:"Items:"})," Click equipped items in the management panel to remove them"]})]})]}),null!==B&&(0,i.jsx)("div",{className:"mt-4 p-3 bg-blue-50 rounded-md",children:(0,i.jsx)("p",{className:"text-sm text-blue-800",children:S[B]?"Managing position ".concat(B+1," - Switch to Items tab to equip items"):"Position ".concat(B+1," selected - Switch to Units tab to place a unit")})})]})})]})]})}},5948:(e,t,s)=>{Promise.resolve().then(s.bind(s,3224))}},e=>{e.O(0,[108,953,441,964,358],()=>e(e.s=5948)),_N_E=e.O()}]);