(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3354:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var s=r(5155),a=r(2115),i=r(6874),l=r.n(i),n=r(2108),d=r(5953);function o(e){var t,r,i,l,o;let{isOpen:c,onClose:m,editComposition:u=null,onSave:x}=e,{data:g}=(0,n.useSession)();(0,a.useEffect)(()=>{var e;if(c&&u&&(null==g||null==(e=g.user)?void 0:e.id)){let e=u.userId===g.user.id,t=g.user.isAdmin;if(!e&&!t){alert("You can only edit your own compositions"),m();return}}},[c,u,g,m]);let[h,b]=(0,a.useState)([]),[p,y]=(0,a.useState)([]),[v,f]=(0,a.useState)([]),[j,N]=(0,a.useState)([]),[k,w]=(0,a.useState)([1,2,3,4,5]),[C,S]=(0,a.useState)(""),[P,A]=(0,a.useState)(!0),[E,B]=(0,a.useState)({name:"",description:"",units:[],rating:"",isPublic:!1}),[I,T]=(0,a.useState)(Array(28).fill(null)),[U,F]=(0,a.useState)("units"),[_,W]=(0,a.useState)(null),[q,L]=(0,a.useState)("all");(0,a.useEffect)(()=>{c&&M()},[c]),(0,a.useEffect)(()=>{c&&u?B({id:u.id,name:u.name,description:u.description||"",units:u.units,rating:u.rating||"",isPublic:u.isPublic}):c&&!u&&B({name:"",description:"",units:[],rating:"",isPublic:!1})},[c,u]);let M=async()=>{try{A(!0);let e=await d.W.getAllGameData();b(e.units),y(e.traits),f(e.items),N(e.components)}catch(e){console.error("Error loading game data:",e)}finally{A(!1)}};(0,a.useEffect)(()=>{let e=Array(28).fill(null);E.units.forEach(t=>{t.position>=0&&t.position<28&&(e[t.position]=t)}),T(e)},[E.units]);let O=h.filter(e=>{let t=k.includes(e.cost),r=e.name.toLowerCase().includes(C.toLowerCase());return t&&r}),D=p.map(e=>{let t=E.units.filter(t=>{let r=h.find(e=>e.id===t.unitId);return null==r?void 0:r.traits.includes(e.name)}).length;if(0===t)return null;let r=e.breakpoints.filter(e=>t>=e.num).sort((e,t)=>t.num-e.num)[0];return{...e,count:t,activeBreakpoint:r||null,isActive:t>0}}).filter(e=>null!==e),z="all"===q?v:v.filter(e=>e.type===q),G=async()=>{var e;if(!(null==g||null==(e=g.user)?void 0:e.id))return void alert("Please log in first");if(!E.name.trim())return void alert("Please provide a composition name");if(0===E.units.length)return void alert("Please add at least one unit to your composition");try{let e;if(E.id){let t={id:E.id,name:E.name.trim(),description:E.description.trim()||null,units:E.units,rating:E.rating||null,isPublic:E.isPublic};e=await d.W.updateComposition(t)}else{let t={userId:g.user.id,addedBy:g.user.name||g.user.email||"Unknown",name:E.name.trim(),description:E.description.trim()||null,units:E.units,rating:E.rating||null,isPublic:E.isPublic};e=await d.W.saveComposition(t)}e?(alert(E.id?"Composition updated successfully!":"Composition saved successfully!"),null==x||x(),m()):alert("Failed to save composition")}catch(e){console.error("Error saving composition:",e),alert("Failed to save composition: ".concat(e instanceof Error?e.message:"Unknown error"))}};return c?P?(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:(0,s.jsx)("div",{className:"bg-white rounded-lg p-8",children:(0,s.jsx)("div",{className:"text-lg",children:"Loading game data..."})})}):(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-7xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:u?"Edit Composition":"Build Composition"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:"Build and save your TFT team compositions"})]}),(0,s.jsx)("button",{onClick:m,className:"text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 text-2xl font-bold",children:"\xd7"})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[(0,s.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 mb-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,s.jsx)("input",{type:"text",placeholder:"Composition Name",value:E.name,onChange:e=>B(t=>({...t,name:e.target.value})),className:"p-2 border border-gray-300 dark:border-gray-500 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),(0,s.jsx)("input",{type:"text",placeholder:"Description (optional)",value:E.description,onChange:e=>B(t=>({...t,description:e.target.value})),className:"p-2 border border-gray-300 dark:border-gray-500 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),(0,s.jsx)("div",{children:(0,s.jsxs)("select",{value:E.rating,onChange:e=>B(t=>({...t,rating:e.target.value})),className:"w-full p-2 border border-gray-300 dark:border-gray-500 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,s.jsx)("option",{value:"",children:"Select Rating (Optional)"}),(0,s.jsx)("option",{value:"S",children:"S Tier - Meta"}),(0,s.jsx)("option",{value:"A",children:"A Tier - Strong"}),(0,s.jsx)("option",{value:"B",children:"B Tier - Good"}),(0,s.jsx)("option",{value:"C",children:"C Tier - Situational"})]})})]}),E.rating&&(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Rating Preview:"}),(0,s.jsxs)("span",{className:"px-3 py-1 rounded-full text-sm font-bold ".concat((e=>{switch(e){case"S":return"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white";case"A":return"bg-gradient-to-r from-green-400 to-green-600 text-white";case"B":return"bg-gradient-to-r from-blue-400 to-blue-600 text-white";case"C":return"bg-gradient-to-r from-gray-400 to-gray-600 text-white";default:return"bg-gray-200 text-gray-600"}})(E.rating)),children:[E.rating," Tier"]})]})}),(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsxs)("label",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:E.isPublic,onChange:e=>B(t=>({...t,isPublic:e.target.checked})),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Make this composition public"}),(0,s.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"(Public compositions can be viewed by all users)"})]})}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{onClick:G,disabled:!g||!E.name.trim(),className:"bg-blue-600 hover:bg-blue-700 disabled:opacity-50 text-white px-4 py-2 rounded-md text-sm font-medium",children:u?"Update Composition":"Save Composition"}),(0,s.jsx)("button",{onClick:()=>{B(e=>({...e,units:[]}))},className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md text-sm font-medium",children:"Clear Board"}),(0,s.jsx)("button",{onClick:m,className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md text-sm font-medium",children:"Cancel"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsx)("div",{className:"lg:col-span-1",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md",children:[(0,s.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,s.jsxs)("nav",{className:"-mb-px flex space-x-8 px-6",children:[(0,s.jsxs)("button",{onClick:()=>F("units"),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat("units"===U?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"),children:["Units (",O.length,")"]}),(0,s.jsxs)("button",{onClick:()=>F("traits"),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat("traits"===U?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"),children:["Traits (",D.length,")"]}),(0,s.jsxs)("button",{onClick:()=>F("items"),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat("items"===U?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"),children:["Items (",v.length,")"]})]})}),(0,s.jsxs)("div",{className:"p-6",children:["units"===U&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("input",{type:"text",placeholder:"Search units...",value:C,onChange:e=>S(e.target.value),className:"w-full p-2 border border-gray-300 dark:border-gray-500 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Cost Filter"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:[1,2,3,4,5].map(e=>(0,s.jsxs)("label",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",checked:k.includes(e),onChange:t=>{t.target.checked?w(t=>[...t,e]):w(t=>t.filter(t=>t!==e))},className:"mr-1"}),(0,s.jsxs)("span",{className:"text-sm text-gray-700 dark:text-gray-200",children:[e," cost"]})]},e))})]}),null!==_&&!I[_]&&(0,s.jsx)("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-md",children:(0,s.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-200 font-medium",children:["Position ",_+1," selected - Choose a unit to place"]})}),(0,s.jsx)("div",{className:"max-h-80 overflow-y-auto space-y-2",children:O.map(e=>(0,s.jsxs)("div",{className:"\n                              flex items-center p-2 rounded-md cursor-pointer transition-colors\n                              ".concat(null===_||I[_]?"bg-gray-50 hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600":"bg-blue-50 hover:bg-blue-100 border border-blue-200 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 dark:border-blue-700","\n                            "),onClick:()=>(e=>{if(null===_||I[_])return;let t={unitId:e.id,position:_,items:[]};B(e=>({...e,units:[...e.units,t]})),W(null),F("units")})(e),children:[(0,s.jsx)("img",{src:e.image,alt:e.name,className:"w-8 h-8 rounded mr-3"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:e.name}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Cost: ",e.cost," | ",e.traits.join(", ")]})]})]},e.id))}),null===_&&(0,s.jsx)("div",{className:"mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-md",children:(0,s.jsx)("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"Select an empty square on the board first, then choose a unit to place there."})})]}),"traits"===U&&(0,s.jsxs)("div",{className:"space-y-2 max-h-80 overflow-y-auto",children:[D.map(e=>(0,s.jsxs)("div",{className:"flex items-center p-2 bg-gray-50 dark:bg-gray-700 rounded-md",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded mr-3 flex items-center justify-center",dangerouslySetInnerHTML:{__html:e.image}}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:e.name}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Active: ",e.count," units"]})]})]},e.id)),0===D.length&&(0,s.jsx)("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"Place units on the board to see active traits"})]}),"items"===U&&(0,s.jsxs)("div",{className:"space-y-4",children:[null!==_&&I[_]&&(0,s.jsxs)("div",{className:"mb-4 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700 rounded-md",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("img",{src:null==(t=h.find(e=>{var t;return e.id===(null==(t=I[_])?void 0:t.unitId)}))?void 0:t.image,alt:"Selected unit",className:"w-6 h-6 rounded mr-2"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-sm text-green-800 dark:text-green-200 font-medium",children:["Managing items for ",null==(r=h.find(e=>{var t;return e.id===(null==(t=I[_])?void 0:t.unitId)}))?void 0:r.name]}),(0,s.jsxs)("p",{className:"text-xs text-green-600 dark:text-green-300",children:[(null==(i=I[_])?void 0:i.items.length)||0,"/3 items equipped"]})]})]}),(null==(l=I[_])?void 0:l.items.length)>0&&(0,s.jsxs)("div",{className:"mt-3",children:[(0,s.jsx)("p",{className:"text-xs font-medium text-green-700 dark:text-green-300 mb-2",children:"Current Items:"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:null==(o=I[_])?void 0:o.items.map((e,t)=>{let r=v.find(t=>t.id===e);return(0,s.jsxs)("div",{className:"flex items-center bg-white dark:bg-gray-800 rounded px-2 py-1 border border-green-200 dark:border-green-700 cursor-pointer hover:bg-red-50 dark:hover:bg-red-900/20",onClick:()=>{null!==_&&B(e=>({...e,units:e.units.map(e=>e.position===_?{...e,items:e.items.filter((e,r)=>r!==t)}:e)}))},children:[(0,s.jsx)("img",{src:null==r?void 0:r.image,alt:null==r?void 0:r.name,className:"w-4 h-4 rounded mr-1"}),(0,s.jsx)("span",{className:"text-xs text-gray-900 dark:text-gray-100",children:null==r?void 0:r.name}),(0,s.jsx)("span",{className:"ml-1 text-red-500 hover:text-red-700",children:"\xd7"})]},t)})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Filter by Type"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:["all","standard","emblem","artifact","other"].map(e=>(0,s.jsx)("button",{onClick:()=>L(e),className:"px-3 py-1 rounded-full text-xs font-medium transition-colors ".concat(q===e?"bg-blue-500 text-white dark:bg-blue-600":"bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),(0,s.jsx)("div",{className:"max-h-64 overflow-y-auto space-y-2",children:z.map(e=>{var t;return(0,s.jsxs)("div",{className:"\n                              flex items-center p-2 rounded-md cursor-pointer transition-colors\n                              ".concat(null!==_&&I[_]&&(null==(t=I[_])?void 0:t.items.length)<3?"bg-green-50 hover:bg-green-100 border border-green-200 dark:bg-green-900/20 dark:hover:bg-green-900/30 dark:border-green-700":"bg-gray-50 hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600","\n                            "),onClick:()=>(e=>{if(null===_)return;let t=I[_];t&&!(t.items.length>=3)&&B(t=>({...t,units:t.units.map(t=>t.position===_?{...t,items:[...t.items,e]}:t)}))})(e.id),children:[(0,s.jsx)("img",{src:e.image,alt:e.name,className:"w-8 h-8 rounded mr-3"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:e.name}),(0,s.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400 capitalize",children:e.type})]})]},e.id)})}),null===_&&(0,s.jsx)("div",{className:"mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-md",children:(0,s.jsx)("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"Select a unit on the board to manage its items."})}),null!==_&&!I[_]&&(0,s.jsx)("div",{className:"mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-md",children:(0,s.jsx)("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"The selected square is empty. Place a unit first to manage items."})})]})]})]})}),(0,s.jsx)("div",{className:"lg:col-span-2",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-4",children:"Team Board"}),D.length>0&&(0,s.jsxs)("div",{className:"mb-6 bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-200 mb-3",children:"Active Traits"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:D.map(e=>{var t,r;return(0,s.jsxs)("div",{className:"flex items-center space-x-2 bg-white dark:bg-gray-800 rounded-lg p-2 border dark:border-gray-600",style:{borderColor:(null==(t=e.activeBreakpoint)?void 0:t.color)||"#e5e7eb",backgroundColor:e.activeBreakpoint?"".concat(e.activeBreakpoint.color,"10"):"white"},children:[(0,s.jsx)("div",{className:"w-6 h-6 rounded flex items-center justify-center",dangerouslySetInnerHTML:{__html:e.image}}),(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsx)("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:e.name}),(0,s.jsx)("span",{className:"ml-2 px-1.5 py-0.5 rounded text-xs font-bold text-white",style:{backgroundColor:(null==(r=e.activeBreakpoint)?void 0:r.color)||"#6b7280"},children:e.count})]})]},e.id)})})]}),(0,s.jsx)("div",{className:"grid grid-cols-7 gap-2 mb-4",children:I.map((e,t)=>{let r=e?h.find(t=>t.id===e.unitId):null,a=_===t;return(0,s.jsx)("div",{className:"\n                          aspect-square border-2 rounded-lg flex flex-col items-center justify-center cursor-pointer relative\n                          ".concat(a?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-400":"border-gray-300 hover:border-gray-400 dark:border-gray-600 dark:hover:border-gray-500","\n                          ").concat(r?"bg-gray-100 dark:bg-gray-700":"bg-gray-50 dark:bg-gray-800","\n                        "),onClick:()=>{I[t]?(W(t),F("items")):(W(t),F("units"))},children:r&&e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),B(e=>({...e,units:e.units.filter(e=>e.position!==t)})),_===t&&W(null)},className:"absolute -top-1 -right-1 bg-red-500 hover:bg-red-600 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs z-10",children:"\xd7"}),(0,s.jsx)("img",{src:r.image,alt:r.name,className:"w-8 h-8 rounded mb-1"}),(0,s.jsx)("div",{className:"text-xs text-center font-medium truncate w-full px-1 text-gray-900 dark:text-gray-100",children:r.name}),e.items.length>0&&(0,s.jsx)("div",{className:"flex gap-1 mt-1",children:e.items.slice(0,3).map((e,t)=>{let r=v.find(t=>t.id===e);return(0,s.jsx)("img",{src:null==r?void 0:r.image,alt:null==r?void 0:r.name,className:"w-3 h-3 rounded border border-gray-400"},t)})})]}):(0,s.jsx)("div",{className:"text-xs text-gray-400 dark:text-gray-500 text-center",children:t+1})},t)})}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:[(0,s.jsx)("p",{children:(0,s.jsx)("strong",{children:"Workflow:"})}),(0,s.jsxs)("ul",{className:"list-disc list-inside mt-1 space-y-1",children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Step 1:"})," Click an empty square on the board to select it"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Step 2:"})," Choose a unit from the Units tab to place there"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Step 3:"})," Click a unit on the board to manage its items"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Remove:"})," Use the red \xd7 button on any unit to remove it"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Items:"})," Click equipped items in the management panel to remove them"]})]})]}),null!==_&&(0,s.jsx)("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-md",children:(0,s.jsx)("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:I[_]?"Managing position ".concat(_+1," - Switch to Items tab to equip items"):"Position ".concat(_+1," selected - Switch to Units tab to place a unit")})})]})})]})]})]})}):null}function c(e){let{showPublicOnly:t=!0,allowEdit:r=!1}=e,{data:i}=(0,n.useSession)(),[l,c]=(0,a.useState)([]),[m,u]=(0,a.useState)([]),[x,g]=(0,a.useState)([]),[h,b]=(0,a.useState)([]),[p,y]=(0,a.useState)(!0),[v,f]=(0,a.useState)(null),[j,N]=(0,a.useState)(!1),[k,w]=(0,a.useState)(null);(0,a.useEffect)(()=>{S(),C()},[i]);let C=async()=>{try{let e=await d.W.getAllGameData();u(e.units),g(e.traits),b(e.items)}catch(e){console.error("Error loading game data:",e)}},S=async()=>{try{var e;let r;y(!0),r=t?await d.W.getCompositions(void 0,!0):(null==i||null==(e=i.user)?void 0:e.id)?await d.W.getCompositions(i.user.id):[],c(r.map(e=>({...e,expandedDetails:void 0})))}catch(e){console.error("Error loading compositions:",e)}finally{y(!1)}},P=e=>{let t=e.units.map(e=>m.find(t=>t.id===e.unitId)).filter(Boolean);t.sort((e,t)=>e.cost-t.cost);let r=new Map;t.forEach(e=>{e.traits.forEach(e=>{r.set(e,(r.get(e)||0)+1)})});let s=Array.from(r.entries()).map(e=>{let[t,r]=e,s=x.find(e=>e.name===t),a=null==s?void 0:s.breakpoints.filter(e=>r>=e.num).sort((e,t)=>t.num-e.num)[0];return{name:t,count:r,color:null==a?void 0:a.color}}).filter(e=>e.count>0),a=new Set;return e.units.forEach(e=>{e.items.forEach(e=>a.add(e))}),{units:t,traits:s,items:Array.from(a).map(e=>h.find(t=>t.id===e)).filter(Boolean)}},A=async e=>{var t;if(!(null==i||null==(t=i.user)?void 0:t.id))return;let r=e.userId===i.user.id,s=i.user.isAdmin;if(!r&&!s)return void alert("You can only delete your own compositions");if(confirm('Are you sure you want to delete "'.concat(e.name,'"?')))try{await d.W.deleteComposition(e.id)?await S():alert("Failed to delete composition")}catch(e){console.error("Error deleting composition:",e),alert("Failed to delete composition")}},E=l.reduce((e,t)=>{let r=t.rating||"Unrated";return e[r]||(e[r]=[]),e[r].push(t),e},{}),B=["S","A","B","C","Unrated"].filter(e=>{var t;return(null==(t=E[e])?void 0:t.length)>0});return p?(0,s.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,s.jsx)("div",{className:"text-lg",children:"Loading compositions..."})}):0===l.length?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("p",{className:"text-gray-600",children:"No compositions found."}),!t&&(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Create your first composition using the builder!"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"space-y-6",children:B.map(e=>(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Unrated"===e?"Unrated Compositions":"".concat(e," Tier Compositions")}),(0,s.jsx)("div",{className:"space-y-2",children:E[e].map(e=>{var t,a;return(0,s.jsx)("div",{children:(0,s.jsx)("div",{className:"\n                      ".concat((null==i||null==(t=i.user)?void 0:t.id)&&(e.userId===i.user.id||i.user.isAdmin)?"cursor-pointer hover:shadow-lg hover:scale-[1.02]":"cursor-default"," transition-all duration-200 rounded-lg border-2 p-4\n                      bg-gradient-to-r ").concat((e=>{switch(e){case"S":return"from-yellow-400 to-yellow-600";case"A":return"from-green-400 to-green-600";case"B":return"from-blue-400 to-blue-600";case"C":return"from-gray-400 to-gray-600";default:return"from-gray-200 to-gray-300"}})(e.rating)," ").concat((e=>{switch(e){case"S":return"border-yellow-500";case"A":return"border-green-500";case"B":return"border-blue-500";case"C":return"border-gray-500";default:return"border-gray-300"}})(e.rating),"\n                    "),onClick:()=>{var t;(null==i||null==(t=i.user)?void 0:t.id)&&(e.userId===i.user.id||i.user.isAdmin)&&(w(e),N(!0))},children:(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("div",{className:"flex-shrink-0 w-48",children:[(0,s.jsx)("h4",{className:"font-medium text-white text-lg drop-shadow-sm truncate",children:e.name}),e.description&&(0,s.jsx)("p",{className:"text-sm text-white/80 drop-shadow-sm truncate",children:e.description})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex flex-wrap gap-1 mb-2",children:[P(e).traits.slice(0,6).map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center bg-black/20 rounded px-2 py-1",children:[(0,s.jsx)("span",{className:"text-white text-xs font-medium drop-shadow-sm",children:e.name}),(0,s.jsxs)("span",{className:"ml-1 text-white/80 text-xs drop-shadow-sm",children:["(",e.count,")"]})]},t)),P(e).traits.length>6&&(0,s.jsxs)("div",{className:"text-white/80 text-xs drop-shadow-sm",children:["+",P(e).traits.length-6," more"]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-1",children:[P(e).units.slice(0,8).map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center bg-white/20 rounded px-2 py-1",children:[(0,s.jsx)("img",{src:e.image,alt:e.name,className:"w-4 h-4 rounded mr-1"}),(0,s.jsx)("span",{className:"text-white text-xs font-medium drop-shadow-sm",children:e.name}),(0,s.jsxs)("span",{className:"ml-1 text-white/70 text-xs drop-shadow-sm",children:["(",e.cost,")"]})]},t)),P(e).units.length>8&&(0,s.jsxs)("div",{className:"text-white/80 text-xs drop-shadow-sm",children:["+",P(e).units.length-8," more"]})]})]}),(0,s.jsxs)("div",{className:"flex-shrink-0 w-32 text-right",children:[(0,s.jsx)("p",{className:"text-sm text-white/80 drop-shadow-sm",children:"Added by"}),(0,s.jsx)("p",{className:"font-medium text-white drop-shadow-sm truncate",children:e.addedBy})]}),e.rating&&(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("div",{className:"text-white font-bold text-sm drop-shadow-sm bg-black/30 px-3 py-1 rounded-full",children:e.rating})}),r&&(null==i||null==(a=i.user)?void 0:a.id)&&(e.userId===i.user.id||i.user.isAdmin)&&(0,s.jsx)("div",{className:"flex-shrink-0 flex space-x-2",children:(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),A(e)},className:"bg-red-500/80 hover:bg-red-600 text-white px-3 py-1 rounded-md text-xs font-medium transition-colors",children:"Delete"})})]})})},e.id)})})]},e))}),(0,s.jsx)(o,{isOpen:j,onClose:()=>{N(!1),w(null)},editComposition:k,onSave:()=>{S()}})]})}function m(){var e,t,r;let{data:i}=(0,n.useSession)(),[d,m]=(0,a.useState)(!1),u=()=>{m(!0)},x=()=>{m(!1)};return(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold text-gray-900 dark:text-white mb-4",children:"TFT Composition Library"}),(0,s.jsx)("p",{className:"text-lg text-gray-600 dark:text-gray-300 mb-8",children:"Discover and share powerful team compositions"}),(0,s.jsxs)("div",{className:"flex justify-center gap-6",children:[i&&(0,s.jsx)("button",{onClick:u,className:"bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg text-lg font-medium transition-colors",children:"Build Composition"}),(null==i||null==(e=i.user)?void 0:e.isAdmin)&&(0,s.jsx)(l(),{href:"/admin",className:"bg-gray-600 hover:bg-gray-700 text-white px-8 py-3 rounded-lg text-lg font-medium transition-colors",children:"Admin Panel"})]})]}),(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Published Compositions"}),i&&(0,s.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Click any composition to open it in the builder"})]}),(0,s.jsx)(c,{showPublicOnly:!0,allowEdit:!!(null==i||null==(t=i.user)?void 0:t.id)})]}),(null==i||null==(r=i.user)?void 0:r.id)&&(0,s.jsxs)("div",{className:"mt-8 bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Your Compositions"}),(0,s.jsx)("button",{onClick:u,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md font-medium transition-colors",children:"Create New"})]}),(0,s.jsx)(c,{showPublicOnly:!1,allowEdit:!0})]}),!i&&(0,s.jsxs)("div",{className:"mt-8 bg-blue-50 dark:bg-blue-900/20 rounded-lg p-6 text-center",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"Get Started"}),(0,s.jsx)("p",{className:"text-blue-700 dark:text-blue-200 mb-4",children:"Sign in to create your own compositions and access the builder tools"}),(0,s.jsx)(l(),{href:"/auth/signin",className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md font-medium transition-colors",children:"Sign In"})]}),(0,s.jsx)(o,{isOpen:d,onClose:x,editComposition:null,onSave:x})]})}},7217:(e,t,r)=>{Promise.resolve().then(r.bind(r,3354))}},e=>{e.O(0,[108,874,953,441,964,358],()=>e(e.s=7217)),_N_E=e.O()}]);